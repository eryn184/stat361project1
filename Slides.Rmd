---
title: "STAT361: "
author: "Sean Froidcoeur, Nicole Tucker, and Sarah Vreeland"
date: "November 1st, 2021"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(fig.retina = 3, warning = FALSE, message = FALSE)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(base_color = "#cc002b")
```

## Introduction

```{r load-packages, warning = FALSE, message = FALSE, echo = FALSE}
library(tidyverse)
library(ggthemes)
library(gt)
library(corrplot)
library(MASS)
library(broom)
```

- How do different demographic and health factors affect insurance charges?

- Beneficial for:
    1. Insurance providers
    2. Those insured
    3. Businesses providing insurance to employees
---

## The Data

```{r load-data, warning = FALSE, message = FALSE, echo =FALSE}
insurance<- read_csv("insurance.csv")
insurance$sex <- as.factor(insurance$sex)
insurance$smoker <- as.factor(insurance$smoker)
insurance$region <- as.factor(insurance$region)
```

Insurance data from Kaggle containing 7 columns with 1338 observations.

Each row/observation is one insured individual.

```{r display-data, warning = FALSE, message = FALSE, echo = FALSE}
insurancetable <- insurance %>%
  slice_head(n = 4)
gt(insurancetable)
```

Categorical variables: Sex, Smoker, Region

Continuous variables: BMI, Age, Children

Response: Charges


---
#Important Summary Statistics 




---
## The Response Variable

```{r response, echo=FALSE, fig.align='left', fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
insurance %>%
  ggplot(aes(x = charges)) +
  geom_histogram() +
  theme_bw()
```

```{r responselog, echo=FALSE, fig.align='right', fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
insurance %>%
  ggplot(aes(x = log(charges))) +
  geom_boxplot() +
  theme_bw()
```


---

## BMI and Charges

```{r graph1, warning = FALSE, message = FALSE, echo=FALSE}
insurance %>%
  ggplot(aes(x = bmi, y = charges)) +
  geom_point() +
  theme_bw()
```


---
## Age and Charges 

```{r graph2, warning = FALSE, message = FALSE, echo=FALSE}
insurance %>%
  ggplot(aes(x = age, y = charges)) +
  geom_point() +
  theme_bw()
```


---
## Children and Charges

```{r graph3, warning = FALSE, message = FALSE, echo=FALSE}
#Children vs Charges
insurance %>%
  ggplot(aes(x = children, y = charges)) +
  geom_boxplot() +
  theme_bw()
```

---
## Sex and Charges 
```{r graph4, warning = FALSE, message = FALSE, echo=FALSE}
insurance %>%
  ggplot(aes(x = sex, y = charges)) +
  geom_point(position = position_jitter(width = .1, height = 0)) +
  theme_bw()
```
---
## Region and Charges
```{r graph5, warning = FALSE, message = FALSE, echo=FALSE}
insurance %>%
  ggplot(aes(x = region, y = charges)) +
  geom_point(position = position_jitter(width = .1, height = 0)) +
  theme_bw()
```

---
## Smoker and Charges

```{r graph6, warning = FALSE, message = FALSE, echo=FALSE}
insurance %>%
  ggplot(aes(x = smoker, y = charges)) +
  geom_point(position = position_jitter(width = .1, height = 0)) +
  theme_bw()
```

---
## Changing BMI to Categorical

According to the CDC:

Below 18.5	Underweight

18.5 – 24.9	Healthy Weight

25.0 – 29.9	Overweight

30.0 and Above	Obesity

---

```{r bmicat, warning=TRUE, message=FALSE, echo=FALSE, fig.align='top'}
insurance <- insurance %>%
  mutate(bmi_categories = case_when(
    bmi >= 30 ~ "Obesity",
    bmi >= 25 ~ "Overweight",
    bmi >= 18.5 ~ "Healthy Weight",
    TRUE ~ "Underweight"
  ))
insurance <- insurance %>%
  dplyr::select(-bmi)
insurance$bmi_categories <- as.factor(insurance$bmi_categories)
insurance %>%
  ggplot(aes(x = age, y = charges, col = bmi_categories)) +
  geom_point(alpha = 0.6, size = 2.5)
```
---
## Models Using Step AIC

```{r stepaic, warning = FALSE, message=FALSE, echo= TRUE, results= FALSE}

intercept_model <- lm(charges~ 1, insurance)
full_model <- lm(charges~ ., insurance)

forward <- stepAIC(intercept_model, direction = "forward", scope = formula(full_model))
backward <- stepAIC(full_model, direction = "backward")
both <- stepAIC(intercept_model, direction = "both", scope = formula(full_model))
```

- Forward Selection:

Charges ~ smoker + age + bmi_categories + children

- Backward Selection:

charges ~ age + children + smoker + bmi_categories

- Both:

charges ~ smoker + age + bmi_categories + children


--

P-Value: < 2.2e-16;; Adjusted R-Squared: 0.7528 
---
## Incorporating Interaction Terms

```{r}
library(ggpubr)
bmi_graph <- insurance %>%
  ggplot(aes(x = age, y = charges, col = bmi_categories)) +
  geom_point(alpha = 0.6, size = 2.5)

smoker_graph <- insurance %>%
  ggplot(aes(x = age, y = charges, col = smoker)) +
  geom_point(alpha = 0.8,size = 2.5)

ggarrange(bmi_graph, smoker_graph,
                    labels = c("A", "B"),
                    ncol = 1, nrow = 2)
```


---
## Checking AOV

---
## Final Model

---

## Residual Analysis

```{r residuals, warning = FALSE, message=FALSE, echo= TRUE, results= FALSE}
#library(ggfortify)
#autoplot()
```


---
## Conclusion

